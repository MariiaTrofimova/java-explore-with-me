# java-explore-with-me
## Этап 2.
### _Основной сервис_
### ER-диаграмма
<img alt = "ER-диаграма основного сервиса" src = "ewm-service/src/main/resources/static/er-diagram-ewm.png">
[Ссылка на диаграмму](stats-server/stats-service/src/main/resources/static/er-diagram-stats.png)

### Описание БД

#### events
Содержит данные о событиях

**Поля:**
* первичный ключ id — идентификатор записи;
* annotation — аннотация события
* category_id — id категории
* description — описание события
* event_date — дата события
* location_id — id локации
* paid — платное ли
* participant_limit — ограничение на кол-во участников (если 0 — без ограничения)
* request_moderation — требуется ли подтверждение заявок
* title — заголовок события
* initiator — id организатора события
* created_on — дата создания события
* published_on — дата публикации
* state — состояние события (ждет модерации, отменено, опубликовано)
* available — есть ли свободные места для записи

#### users
Содержит данные о пользователях.

**Поля:**
* первичный ключ id — идентификатор записи;
* name — уникальное имя пользователя
* email — уникальный email 

#### categories
Содержит данные о категориях.

**Поля:**
* первичный ключ id — идентификатор записи;
* name — уникальное название категории

#### locations
Содержит данные о локациях.

**Поля:**
* первичный ключ id — идентификатор записи;
* lat — широта
* lon — долгота
* 
#### requests
Содержит данные о заявках на участие в событиях.

**Поля:**
* первичный ключ id — идентификатор записи;
* event_id — id события
* requester_id — id пользователя, который отправил заявку
* created — дата создания заявки
* status — статус заявки (ждет модерации, отклонена, отменена, подтверждена)

#### compilations
Содержит данные о подборках.

**Поля:**
* первичный ключ id — идентификатор записи;
* title — уникальное название подборки
* pinned — закреплена ли подборка на главной странице

#### compilations_events
Вспомогательная таблица многие-ко многим.
Содержит данные о связи подборок и событий.

**Поля:**
* compilation_id — id подборки
* event_id — id события


## Этап 1. 
### _Сервис статистики_
### ER-диаграмма

<img alt = "ER-диаграмма" src = "stats-server/stats-service/src/main/resources/static/er-diagram-stats.png">
[Ссылка на диаграмму](stats-server/stats-service/src/main/resources/static/er-diagram-stats.png)

### Описание БД

#### apps
Содержит данные о сервисах и uri, для которых собирается статистика. 

**Поля:**
* первичный ключ id — идентификатор записи;
* name — название сервиса для которого записывается информация
* uri — URI сервиса

#### hits
Содержит данные о просмотрах.

**Поля:**
* первичный ключ id — идентификатор записи;
* app_id — идентификатор пары сервис-uri
* ip — IP-адрес пользователя, осуществившего запрос
* timestamp — дата и время запроса

### _HTTP-клиент для работы с сервисом статистики_
#### Тесты E2E для клиента
Прописаны в контроллере EventController в основном сервисе.

#### Запись в базу
* http://localhost:8080/events/{id} — записать данные о просмотре соответствующей страницы "/event/{id}"

#### Запрос статистики
* http://localhost:8080/events/stats — получить статистику за прошедший час
* http://localhost:8080/events/stats-uris — получить статистику за прошедший час для списка из "/events/1"
* http://localhost:8080/events/stats-unique — получить статистику уникальных просмотров за прошедший час
* http://localhost:8080/events/stats-uris-unique — получить статистику уникальных просмотров за прошедший час 
для списка из "/events/1" и "/events/2"
